const y=function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))l(e);new MutationObserver(e=>{for(const n of e)if(n.type==="childList")for(const i of n.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&l(i)}).observe(document,{childList:!0,subtree:!0});function c(e){const n={};return e.integrity&&(n.integrity=e.integrity),e.referrerpolicy&&(n.referrerPolicy=e.referrerpolicy),e.crossorigin==="use-credentials"?n.credentials="include":e.crossorigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function l(e){if(e.ep)return;e.ep=!0;const n=c(e);fetch(e.href,n)}};y();function m(t=320,r=240,c="#ffffff"){this.el=document.createElement("canvas"),this.ctx=this.el.getContext("2d"),this.el.width=t,this.el.height=r,this.ctx.fillStyle=c,this.ctx.fillRect(0,0,t,r)}function p(t){return new Promise((r,c)=>{if(t){let l=new Image;l.onload=function(e){r(l)},l.onerror=function(e){c(e)},l.setAttribute("crossOrigin","anonymous"),l.src=t}else c(new Error("no src"))})}const S={quality:.75,format:"jpg",outputType:"base64",width:320,height:null,reSample:2,bgColor:"#ffffff",saveExif:!1},x={canvas:null,reSample:2,width:320,height:240,cx:0,cy:0,cw:0,ch:0,dx:0,dy:0,dw:0,dh:0,bgColor:"#ffffff"};function I(t,r,c){return new Promise(l=>{function e(n,i){const o=Math.pow(2,n);let a=new m(t.width*o,t.height*o,t.bgColor);a.ctx.drawImage(i,0,0,i.width*.5,i.height*.5),n>0?e(n-1,a.el):l(a.el)}e(r-1,c)})}function P(t){t=Object.assign({},x,t),t.reSample=Math.min(4,t.reSample),t.reSample=Math.max(0,t.reSample);const r=Math.pow(2,t.reSample);return new Promise(function(c,l){try{const e=new m(t.width*r,t.height*r,t.bgColor);e.ctx.drawImage(t.canvas,t.cx,t.cy,t.cw,t.ch,t.dx*r,t.dy*r,t.dw*r,t.dh*r),t.reSample>0?I(t,t.reSample,e.el).then(c):c(e.el)}catch(e){l(e)}})}function R(t,r="image/jpeg",c=.75){return r=b(r),new Promise(function(l,e){try{const n=t.toDataURL(r,c);l(n)}catch(n){e(n)}})}function C(t,r="image/jpeg",c=.75){return r=b(r),new Promise(function(l,e){try{const n=t.toDataURL(r,c),i=E(n);l(i)}catch(n){e(n)}})}function b(t){let r=null;switch(t){case"jpg":case"jpeg":r="image/jpeg";break;case"png":r="image/png";break;default:r=t;break}return r}function E(t){const r=atob(t.split(",")[1]),c=t.split(",")[0].split(":")[1].split(";")[0],l=new ArrayBuffer(r.length);let e=new Uint8Array(l);for(let o=0;o<r.length;o++)e[o]=r.charCodeAt(o);const n=new DataView(l);return new Blob([n],{type:c})}function z(t={}){this.options=r(S,t);function r(e={},n={}){let i={};return Object.keys(e).forEach(function(o){i[o]=n[o]||e[o]}),i.width=Number(i.width),i.height=Number(i.height),i.quality=Number(i.quality),i.reSample=Number(i.reSample),i}function c(e,n){let i=null;return new Promise(function(o,a){p(e).then(function(u){i=new m(u.width,u.height,n.bgColor),i.ctx.drawImage(u,0,0),o(i.el)},function(u){a(u)})})}function l(e,n){let i=null;return new Promise(function(o,a){function u(w){a(w)}const d=new FileReader;d.onload=function(w){const s=new Image;s.onload=function(){i=new m(s.width,s.height,n.bgColor),i.ctx.drawImage(s,0,0),o(i.el)},s.onerror=u,s.src=w.target.result},d.onerror=u,d.readAsDataURL(e.files[0])})}this.play=function(e){return new Promise((n,i)=>{this.get(e).then(o=>this.resize(o)).then(o=>this.output(o)).then(o=>n(o)).catch(o=>i(o))})},this.get=function(e,n=null){return n=n?r(this.options,n):this.options,new Promise((i,o)=>{typeof e=="string"?i(c(e,n)):typeof e=="object"?i(l(e,n)):o(new Error("Not found source"))})},this.resize=function(e,n=null){return n=n?r(this.options,n):this.options,new Promise((i,o)=>{let a=O(e.width,e.height,n.width,n.height);P({canvas:e,reSample:n.reSample,width:a.width,height:a.height,cx:0,cy:0,cw:e.width,ch:e.height,dx:0,dy:0,dw:a.width,dh:a.height,bgColor:n.bgColor}).then(i).catch(o)})},this.output=function(e,n=null){return n=n?r(this.options,n):this.options,new Promise((i,o)=>{switch(n.outputType){case"base64":R(e,n.format,n.quality).then(i).catch(o);break;case"blob":C(e,n.format,n.quality).then(i).catch(o);break;case"canvas":default:i(e);break}})},this.updateOptions=function(e){return this.options=r(this.options,e),this}}function O(t,r,c,l){let e=t,n=r;return c&&l&&(c>l?l=null:c=null),c?(e=c,n=r*(c/t)):l&&(e=t*(l/r),n=l),{width:parseInt(e),height:parseInt(n)}}const f=new z,L=document.getElementById("form"),g=document.getElementById("result"),h=new Proxy({},{get:(t,r)=>t[r],set:(t,r,c)=>{switch(r){case"width":case"height":case"quality":case"reSample":c=Number(c);break}return t[r]=c,!0}});function k(t){t.preventDefault();const r=t.target,c=r.querySelectorAll("[name]");for(const e of c)h[e.name]=e.value;let l;if(h.upload)l=r.querySelector("[name=upload]");else if(h.url)l=h.url;else return alert("not found source"),!1;g.innerHTML="",f.updateOptions(h).get(l).then(function(e){return f.resize(e)}).then(function(e){return N(e)}).then(function(e){return f.output(e)}).then(q).catch(T)}function N(t){return new Promise(function(r){console.warn("Ready:",f.options),r(t)})}function q(t){switch(f.options.outputType){case"base64":const r=new Image;r.src=t,g.appendChild(r);break;case"canvas":g.appendChild(t);break;case"blob":default:console.log("RESULT:",t);break}}function T(t){console.error("ERROR EVENT",t),alert(`Error resize: ${t.message}`)}L.addEventListener("submit",k);
