const w=function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))a(e);new MutationObserver(e=>{for(const t of e)if(t.type==="childList")for(const i of t.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&a(i)}).observe(document,{childList:!0,subtree:!0});function l(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerpolicy&&(t.referrerPolicy=e.referrerpolicy),e.crossorigin==="use-credentials"?t.credentials="include":e.crossorigin==="anonymous"?t.credentials="omit":t.credentials="same-origin",t}function a(e){if(e.ep)return;e.ep=!0;const t=l(e);fetch(e.href,t)}};w();function u(r=320,n=240,l="#ffffff"){this.el=document.createElement("canvas"),this.ctx=this.el.getContext("2d"),this.el.width=r,this.el.height=n,this.ctx.fillStyle=l,this.ctx.fillRect(0,0,r,n)}const g={quality:.75,format:"jpg",outputType:"base64",width:320,height:null,reSample:2,bgColor:"#ffffff",saveExif:!1},b={canvas:null,reSample:2,width:320,height:240,cx:0,cy:0,cw:0,ch:0,dx:0,dy:0,dw:0,dh:0,bgColor:"#ffffff"};function y(r,n,l){return new Promise(a=>{function e(t,i){const c=Math.pow(2,t);let s=new u(r.width*c,r.height*c,r.bgColor);s.ctx.drawImage(i,0,0,i.width*.5,i.height*.5),t>0?e(t-1,s.el):a(s.el)}e(n-1,l)})}function p(r){r=Object.assign({},b,r),r.reSample=Math.min(4,r.reSample),r.reSample=Math.max(0,r.reSample);const n=Math.pow(2,r.reSample);return new Promise(function(l,a){try{const e=new u(r.width*n,r.height*n,r.bgColor);e.ctx.drawImage(r.canvas,r.cx,r.cy,r.cw,r.ch,r.dx*n,r.dy*n,r.dw*n,r.dh*n),r.reSample>0?y(r,r.reSample,e.el).then(l):l(e.el)}catch(e){a(e)}})}function S(r,n="image/jpeg",l=.75){return n=m(n),new Promise(function(a,e){try{const t=r.toDataURL(n,l);a(t)}catch(t){e(t)}})}function x(r,n="image/jpeg",l=.75){return n=m(n),new Promise(function(a,e){try{const t=r.toDataURL(n,l),i=R(t);a(i)}catch(t){e(t)}})}function m(r){let n;switch(r){case"jpg":case"jpeg":n="image/jpeg";break;case"png":n="image/png";break;default:n=r;break}return n}function R(r){const n=atob(r.split(",")[1]),l=r.split(",")[0].split(":")[1].split(";")[0],a=new ArrayBuffer(n.length);let e=new Uint8Array(a);for(let c=0;c<n.length;c++)e[c]=n.charCodeAt(c);const t=new DataView(a);return new Blob([t],{type:l})}function C(r){return new Promise((n,l)=>{const a=new FileReader;a.onload=e=>{var t;return n((t=e.target)==null?void 0:t.result)},a.onerror=l,a.readAsDataURL(r)})}function d(r){return new Promise((n,l)=>{const a=new Image;a.onload=()=>n(a),a.onerror=l,a.src=r,a.crossOrigin="anonymous",a.alt=""})}function z(r={}){this.options=n(g,r);function n(e={},t={}){let i={};return Object.keys(e).forEach(c=>{i[c]=t[c]||e[c]}),i.width=Number(i.width),i.height=Number(i.height),i.quality=Number(i.quality),i.reSample=Number(i.reSample),i}async function l(e,t){let i;const c=await d(e);return i=new u(c.width,c.height,t.bgColor),i.ctx.drawImage(c,0,0),i.el}async function a(e,t){const i=await C(e),c=await d(i);let s=new u(c.width,c.height,t.bgColor);return s.ctx.drawImage(c,0,0),s.el}this.play=async e=>{let t=await this.get(e);return t=await this.resize(t),t=await this.resize(t),t=await this.output(t),t},this.get=async function(e,t=null){var i;if(t=t?n(this.options,t):this.options,typeof e=="string")return await l(e,t);if(e instanceof File||e instanceof Blob)return await a(e,t);if(((i=e.tagName)==null?void 0:i.toLowerCase())==="input"&&e.type==="file")return await a(e.files[0],t);throw new Error("Not found source")},this.resize=async(e,t)=>{t=t?n(this.options,t):this.options;let i=E(e.width,e.height,t.width,t.height);return await p({canvas:e,reSample:t.reSample,width:i.width,height:i.height,cx:0,cy:0,cw:e.width,ch:e.height,dx:0,dy:0,dw:i.width,dh:i.height,bgColor:t.bgColor})},this.output=function(e,t){return t=t?n(this.options,t):this.options,new Promise((i,c)=>{switch(t.outputType){case"base64":S(e,t.format,t.quality).then(i).catch(c);break;case"blob":x(e,t.format,t.quality).then(i).catch(c);break;case"canvas":default:i(e);break}})},this.updateOptions=function(e){return this.options=n(this.options,e),this}}function E(r,n,l,a){let e=r,t=n;return l&&a&&(l>a?a=void 0:l=void 0),l?(e=l,t=n*(l/r)):a&&(e=r*(a/n),t=a),{width:Number(e),height:Number(t)}}const f=new z,I=document.getElementById("form"),h=document.getElementById("result"),o=new Proxy({},{get:(r,n)=>r[n],set:(r,n,l)=>{switch(n){case"width":case"height":case"quality":case"reSample":l=Number(l);break}return r[n]=l,!0}});console.log("imageResize",f);async function L(r){r.preventDefault();const n=r.target,l=n.querySelectorAll("[name]");for(const e of l)o[e.name]=e.value;let a;if(o.upload)a=n.querySelector("[name=upload]"),a=a.files[0],a=new Blob([a],{type:a.type});else if(o.url)a=o.url;else return alert("not found source"),!1;h.innerHTML="";try{let e=await f.updateOptions(o).play(a);N(e)}catch(e){O(e)}}function N(r){switch(f.options.outputType){case"base64":const n=new Image;n.src=r,h.appendChild(n);break;case"canvas":h.appendChild(r);break;case"blob":default:console.log("RESULT:",r);break}}function O(r){console.error("ERROR EVENT",r),alert(`Error resize: ${r.message}`)}I.addEventListener("submit",L);
