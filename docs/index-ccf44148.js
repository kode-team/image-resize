(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))n(a);new MutationObserver(a=>{for(const i of a)if(i.type==="childList")for(const c of i.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&n(c)}).observe(document,{childList:!0,subtree:!0});function e(a){const i={};return a.integrity&&(i.integrity=a.integrity),a.referrerpolicy&&(i.referrerPolicy=a.referrerpolicy),a.crossorigin==="use-credentials"?i.credentials="include":a.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(a){if(a.ep)return;a.ep=!0;const i=e(a);fetch(a.href,i)}})();const P={quality:.75,format:"jpg",outputType:"base64",width:320,height:null,reSample:2,bgColor:"#ffffff",sharpen:0};function b(r=320,t=240,e="#ffffff"){this.el=document.createElement("canvas"),this.ctx=this.el.getContext("2d"),this.el.width=r,this.el.height=t,this.ctx.fillStyle=e,this.ctx.fillRect(0,0,r,t)}const j={canvas:null,reSample:2,width:320,height:240,cx:0,cy:0,cw:0,ch:0,dx:0,dy:0,dw:0,dh:0,bgColor:"#ffffff"};function k(r,t,e){return new Promise(n=>{function a(i,c){const s=Math.pow(2,i);let l=new b(r.width*s,r.height*s,r.bgColor);l.ctx.drawImage(c,0,0,c.width*.5,c.height*.5),i>0?a(i-1,l.el):n(l.el)}a(t-1,e)})}function B(r){r=Object.assign({},j,r),r.reSample=Math.min(4,r.reSample),r.reSample=Math.max(0,r.reSample);const t=Math.pow(2,r.reSample);return new Promise(function(e,n){try{const a=new b(r.width*t,r.height*t,r.bgColor);a.ctx.drawImage(r.canvas,r.cx,r.cy,r.cw,r.ch,r.dx*t,r.dy*t,r.dw*t,r.dh*t),r.reSample>0?k(r,r.reSample,a.el).then(e):e(a.el)}catch(a){n(a)}})}function D(r,t="image/jpeg",e=.75){return t=L(t),new Promise(function(n,a){try{const i=r.toDataURL(t,e);n(i)}catch(i){a(i)}})}function T(r,t="image/jpeg",e=.75){return t=L(t),new Promise(function(n,a){try{const i=r.toDataURL(t,e),c=A(i);n(c)}catch(i){a(i)}})}function L(r){let t;switch(r){case"jpg":case"jpeg":t="image/jpeg";break;case"png":t="image/png";break;case"webp":t="image/webp";break;default:t=r;break}return t}function A(r){const t=atob(r.split(",")[1]),e=r.split(",")[0].split(":")[1].split(";")[0],n=new ArrayBuffer(t.length);let a=new Uint8Array(n);for(let c=0;c<t.length;c++)a[c]=t.charCodeAt(c);const i=new DataView(n);return new Blob([i],{type:e})}function $(r,t,e){const n=r.data,a=t.data,i=r.width,c=r.height,s=Math.round(Math.sqrt(e.length)),l=Math.floor(s/2),C=i,M=c;for(let f=0;f<M;f++)for(let h=0;h<C;h++){let I=0,O=0,N=0,R=0;for(let m=0;m<s;m++)for(let w=0;w<s;w++){const p=f+m-l,S=h+w-l;if(p>=0&&p<c&&S>=0&&S<i){let g=(p*i+S)*4,y=e[m*s+w];I+=n[g]*y,O+=n[g+1]*y,N+=n[g+2]*y,R+=n[g+3]*y}}const d=(f*C+h)*4;a[d]=I,a[d+1]=O,a[d+2]=N,a[d+3]=R}return t}function F(r,t=0){if(t<=0)return r;const e=document.createElement("canvas");e.width=r.width,e.height=r.height;const n=e.getContext("2d");n.drawImage(r,0,0);const a=n.getImageData(0,0,e.width,e.height),i=n.createImageData(e.width,e.height),c=$(a,i,[0,-1,0,-1,5,-1,0,-1,0]);n.putImageData(c,0,0);const s=r.getContext("2d");return s.globalAlpha=t||1,s.drawImage(e,0,0),r}function v(r){return new Promise((t,e)=>{const n=new FileReader;n.onload=a=>{var i;return t((i=a.target)==null?void 0:i.result)},n.onerror=e,n.readAsDataURL(r)})}function z(r){return new Promise((t,e)=>{const n=new Image;n.onload=()=>t(n),n.onerror=e,n.src=r,n.crossOrigin="anonymous",n.alt=""})}function o(r={},t={}){let e={};return Object.keys(r).forEach(n=>{e[n]=t[n]||r[n]}),e.width=Number(e.width),e.height=Number(e.height),e.quality=Number(e.quality),e.reSample=Number(e.reSample),e}async function U(r,t){let e;const n=await z(r);return e=new b(n.width,n.height,t.bgColor),e.ctx.drawImage(n,0,0),e.el}async function E(r,t){const e=await v(r),n=await z(e);let a=new b(n.width,n.height,t.bgColor);return a.ctx.drawImage(n,0,0),a.el}function V(r,t,e,n){let a=r,i=t;return e&&n&&(e>n?n=void 0:e=void 0),e?(a=e,i=t*(e/r)):n&&(a=r*(n/t),i=n),{width:Number(a),height:Number(i)}}class K{constructor(t={}){this.options=o(P,t)}async play(t){let e=await this.get(t);return e=await this.resize(e),e=await this.sharpen(e),e=await this.output(e),e}async get(t,e=void 0){var n;if(e=e?o(this.options,e):this.options,typeof t=="string")return await U(t,e);if(t instanceof File||t instanceof Blob)return await E(t,e);if(((n=t.tagName)==null?void 0:n.toLowerCase())==="input"&&t.type==="file")return await E(t.files[0],e);throw new Error("Not found source")}async resize(t,e=void 0){e=e?o(this.options,e):this.options;let n=V(t.width,t.height,e.width,e.height);return await B({canvas:t,reSample:e.reSample,width:n.width,height:n.height,cx:0,cy:0,cw:t.width,ch:t.height,dx:0,dy:0,dw:n.width,dh:n.height,bgColor:e.bgColor})}sharpen(t,e=void 0){return e=isNaN(e)?this.options.sharpen:e,F(t,e)}async output(t,e=void 0){switch(e=e?o(this.options,e):this.options,e.outputType){case"base64":return await D(t,e.format,e.quality);case"blob":return await T(t,e.format,e.quality);case"canvas":default:return t}}updateOptions(t){return this.options=o(this.options,t),this}}const q=new K,_=document.getElementById("form"),x=document.getElementById("result"),u=new Proxy({},{get:(r,t)=>r[t],set:(r,t,e)=>{switch(t){case"width":case"height":case"quality":case"reSample":case"sharpen":e=Number(e);break}return r[t]=e,!0}});async function G(r){r.preventDefault();const t=r.target,e=t.querySelectorAll("[name]");for(const a of e)u[a.name]=a.value;let n;if(u.upload)n=t.querySelector("[name=upload]"),n=n.files[0],n=new Blob([n],{type:n.type});else if(u.url)n=u.url;else return alert("not found source"),!1;x.innerHTML="";try{let a=await q.updateOptions(u).play(n);J(a)}catch(a){Q(a)}}function J(r){switch(q.options.outputType){case"base64":const t=new Image;t.src=r,x.appendChild(t);break;case"canvas":x.appendChild(r);break;case"blob":default:console.log("RESULT:",r);break}}function Q(r){console.error("ERROR EVENT",r),alert(`Error resize: ${r.message}`)}_.addEventListener("submit",G);
